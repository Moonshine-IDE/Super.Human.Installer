---
- 
  name: "Checking if Genesis {{ genesis_version }} is installed"
  register: genesis_installed_check
  stat:
    path: "{{ completed_dir }}/genesis_installed_check"
    get_md5: no

-
  name: "Creating installation directories for Genesis"
  when: genesis_installed_check.stat.exists == false
  file:
    path: "{{ item }}"
    state: directory
    owner: "{{ domino_user }}"
    group: "{{ domino_group }}"
  with_items:
    - "{{ domino_home_dir }}/JavaAddin/Genesis"
    - "{{ domino_home_dir }}/JavaAddin/Genesis/json"

-
  become: true
  name: "Stopping Domino for Changes to take effect"
  when: genesis_installed_check.stat.exists == false
  service:
    name: domino
    state: stopped
    enabled: yes
  register: DominoServiceDetailsStop
  until: DominoServiceDetailsStop.state == "stopped"
  retries: 3
  delay: 5

- 
  name: Pause for 30 seconds to let Domino fully shutdown
  when: genesis_installed_check.stat.exists == false
  pause:
    seconds: 30

-
  name: "Placing Genesis template Configuration file"
  when: genesis_installed_check.stat.exists == false
  become: true
  copy:
    dest: "{{ domino_home_dir }}/JavaAddin/Genesis/{{ genesis_jar }}"
    owner: "{{ domino_user }}"
    src: "{{ genesis_jar }}"

-
  become: true
  name: "Starting Domino for Changes to take effect"
  when: genesis_installed_check.stat.exists == false
  service:
    name: domino
    state: started
    enabled: yes
  register: DominoServiceDetailsStart
  until: DominoServiceDetailsStart.state == "started"
  retries: 10
  delay: 30

- 
  name: "Debug"
  when: debug and genesis_installed_check.stat.exists == false
  debug: 
    var: DominoServiceDetailsStart

-
  name: "Marking Genesis as installed"
  when:  genesis_installed_check.stat.exists == false
  file:
    path: "{{ item }}"
    state: touch
  with_items:
    - "{{ completed_dir }}/genesis_installed_check"
